<% layout("./layouts/boilerplate")-%>

<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
      <div class="card shadow-sm border-0">
        <div class="card-body p-4">
          <!-- Header -->
          <div class="text-center mb-4">
            <i
              class="bi bi-envelope-check-fill text-primary"
              style="font-size: 3rem"
            ></i>
            <h3 class="mt-3">Verify Your Email</h3>
            <p class="text-muted">
              We've sent a 6-digit code to<br />
              <strong><%= email %></strong>
            </p>
          </div>

          <!-- Verification Form -->
          <form action="/verify-email" method="POST">
            <div class="mb-3">
              <label for="otp" class="form-label"
                >Enter Verification Code</label
              >
              <input
                type="text"
                class="form-control form-control-lg text-center"
                id="otp"
                name="otp"
                placeholder="000000"
                maxlength="6"
                pattern="[0-9]{6}"
                required
                autofocus
                autocomplete="off"
                style="letter-spacing: 0.5em; font-size: 1.5rem"
              />
              <div class="form-text text-center">
                <i class="bi bi-clock me-1"></i>
                Code expires in
                <strong><span id="timer"><%= remainingTime %></span>s</strong>
              </div>
            </div>

            <button type="submit" class="btn btn-color w-100 mb-3">
              <i class="bi bi-check-circle me-2"></i>Verify Email
            </button>
          </form>

          <!-- Resend OTP -->
          <div class="text-center">
            <p class="text-muted small mb-2">Didn't receive the code?</p>
            <% if (canResend) { %>
            <form action="/resend-otp" method="POST" class="d-inline">
              <button type="submit" class="btn btn-link btn-sm p-0">
                <i class="bi bi-arrow-clockwise me-1"></i>Resend Code
              </button>
            </form>
            <% } else { %>
            <button class="btn btn-link btn-sm p-0" disabled>
              <i class="bi bi-arrow-clockwise me-1"></i>Resend Code (wait 60s)
            </button>
            <% } %>
          </div>

          <!-- Help Text -->
          <div class="alert alert-info mt-4 mb-0">
            <small>
              <i class="bi bi-info-circle me-1"></i>
              <strong>Check your spam folder</strong> if you don't see the
              email. The code is valid for 10 minutes.
            </small>
          </div>

          <!-- Back to Signup -->
          <div class="text-center mt-3">
            <a href="/signup" class="text-muted small">
              <i class="bi bi-arrow-left me-1"></i>Back to Signup
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Countdown timer
  let timeLeft = <%= remainingTime %>;
  const timerElement = document.getElementById("timer");

  const countdown = setInterval(() => {
    timeLeft--;
    timerElement.textContent = timeLeft;

    if (timeLeft <= 0) {
      clearInterval(countdown);
      timerElement.parentElement.innerHTML =
        '<span class="text-danger"><i class="bi bi-exclamation-triangle me-1"></i>Code expired! Please sign up again.</span>';
      document.querySelector('button[type="submit"]').disabled = true;
    }
  }, 1000);

  // Auto-format OTP input (numbers only)
  const otpInput = document.getElementById("otp");
  otpInput.addEventListener("input", function (e) {
    this.value = this.value.replace(/[^0-9]/g, "");
  });

  // Auto-submit when 6 digits entered
  otpInput.addEventListener("input", function (e) {
    if (this.value.length === 6) {
      // Optional: auto-submit
      // this.form.submit();
    }
  });
</script>

<style>
  .card {
    border-radius: 15px;
  }

  #otp:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
  }

  .btn-color {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    color: white;
  }

  .btn-color:hover {
    background: linear-gradient(135deg, #5568d3 0%, #6a4293 100%);
    color: white;
  }
</style>
